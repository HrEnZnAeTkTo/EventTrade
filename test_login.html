<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .error { background: #fee; color: red; }
        .success { background: #efe; color: green; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç API –≤—Ö–æ–¥–∞</h1>
    
    <button onclick="testConnection()">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
    <button onclick="testProducts()">–¢–µ—Å—Ç —Ç–æ–≤–∞—Ä–æ–≤</button>
    <button onclick="testLogin()">–¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
    <button onclick="testHealth()">–¢–µ—Å—Ç –∑–¥–æ—Ä–æ–≤—å—è</button>
    
    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        const resultsDiv = document.getElementById('results');

        function addResult(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'result ' + (isError ? 'error' : 'success');
            div.innerHTML = '<strong>' + new Date().toLocaleTimeString() + ':</strong> ' + message;
            resultsDiv.appendChild(div);
        }

        async function testConnection() {
            try {
                const response = await fetch(API_BASE + '/health');
                const data = await response.json();
                addResult('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API —Ä–∞–±–æ—Ç–∞–µ—Ç: ' + JSON.stringify(data));
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, true);
            }
        }

        async function testProducts() {
            try {
                const response = await fetch(API_BASE + '/products');
                const data = await response.json();
                addResult('‚úÖ –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ' + data.length + ' —à—Ç. –ü–µ—Ä–≤—ã–π: ' + (data[0]?.name || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'));
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: ' + error.message, true);
            }
        }

        async function testLogin() {
            try {
                const response = await fetch(API_BASE + '/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                addResult('üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ' + response.status + ' ' + response.statusText);
                
                const data = await response.json();
                
                if (response.ok) {
                    addResult('‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ' + data.user?.username + ', —Ä–æ–ª—å: ' + data.user?.role);
                } else {
                    addResult('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), true);
                }
            } catch (error) {
                addResult('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ: ' + error.message, true);
            }
        }

        async function testHealth() {
            try {
                const response = await fetch(API_BASE + '/health');
                const text = await response.text();
                addResult('üè• –°—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è API: ' + response.status + ', –æ—Ç–≤–µ—Ç: ' + text);
            } catch (error) {
                addResult('‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + error.message, true);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç—ã...');
            setTimeout(testConnection, 500);
        };
    </script>
</body>
</html>